<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KM BURGER - Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        .bg-km-vinho { background-color: #4a0404; }
        .text-km-amarelo { color: #f59e0b; }
    </style>
</head>
<body class="bg-gray-100 font-sans pb-32">

    <header class="bg-km-vinho p-6 text-center text-white shadow-xl sticky top-0 z-50">
        <h1 class="text-3xl font-black italic text-km-amarelo">KM BURGER üçî</h1>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-8">
        <div id="categorias-container" class="space-y-8"></div>
        <section class="bg-purple-900 p-5 rounded-3xl shadow-lg text-white">
            <h2 class="font-bold text-xl mb-4 text-center text-km-amarelo">MONTE SEU A√áA√ç üçß</h2>
            <div id="acai-sizes" class="grid grid-cols-2 gap-3 text-white"></div>
        </section>
    </main>

    <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 shadow-2xl max-w-md mx-auto z-40">
        <div class="flex justify-between items-center mb-2 px-2 font-bold text-gray-700">
            <span>Total:</span><span id="carrinho-total" class="text-2xl text-green-600">R$ 0,00</span>
        </div>
        <button onclick="abrirCheckout()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold shadow-lg">FINALIZAR PEDIDO</button>
    </div>

    <div id="modal-acai" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 text-gray-800">
            <h2 id="acai-titulo" class="text-xl font-bold text-purple-900 mb-4"></h2>
            <div id="lista-adicionais" class="space-y-2 max-h-60 overflow-y-auto"></div>
            <div class="border-t pt-4 mt-4 font-bold">
                <div class="flex justify-between text-lg mb-4"><span>Subtotal:</span><span id="acai-subtotal">R$ 0,00</span></div>
                <button onclick="confirmarAcai()" class="w-full bg-purple-600 text-white py-4 rounded-2xl">ADICIONAR</button>
                <button onclick="document.getElementById('modal-acai').classList.add('hidden')" class="w-full mt-2 text-gray-400">Voltar</button>
            </div>
        </div>
    </div>

    <div id="modal-checkout" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50 text-gray-800">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
            <h2 class="text-xl font-bold mb-4 text-center">Finalizar Pedido</h2>
            <div class="space-y-3">
                <input type="text" id="nome" placeholder="Seu Nome" class="w-full p-4 border rounded-xl outline-none">
                <select id="tipo-entrega" onchange="toggleEndereco()" class="w-full p-4 border rounded-xl outline-none bg-white">
                    <option value="entrega">Entrega (Delivery)</option>
                    <option value="retirada">Retirada na Loja</option>
                </select>
                <input type="text" id="endereco" placeholder="Endere√ßo Completo" class="w-full p-4 border rounded-xl outline-none">
                <input type="text" id="pagamento" placeholder="Forma de Pagamento (Pix/Cart√£o)" class="w-full p-4 border rounded-xl outline-none">
            </div>
            <button onclick="enviarPedidoFirebase()" class="w-full bg-green-600 text-white py-5 rounded-2xl font-bold text-lg mt-6 active:scale-95 transition">ENVIAR PEDIDO</button>
            <button onclick="document.getElementById('modal-checkout').classList.add('hidden')" class="w-full mt-2 text-gray-400">Voltar</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCXNjKn-uP2dpf_OG_pzUkqa-RnS-3V1L4",
            authDomain: "km-burguer.firebaseapp.com",
            projectId: "km-burguer",
            databaseURL: "https://km-burguer-default-rtdb.firebaseio.com",
            storageBucket: "km-burguer.firebasestorage.app",
            messagingSenderId: "426968901226",
            appId: "1:426968901226:web:e05f587e2c36acaa714c13"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const cardapio = [
            { n: "X-Burguer", p: 19.90, c: "üçî HAMB√öRGUER" },
            { n: "X-Salada", p: 22.90, c: "üçî HAMB√öRGUER" },
            { n: "X-Bacon", p: 27.90, c: "üçî HAMB√öRGUER" },
            { n: "X-Calabresa", p: 24.90, c: "üçî HAMB√öRGUER" },
            { n: "X-Egg", p: 24.90, c: "üçî HAMB√öRGUER" },
            { n: "X-Frango", p: 24.90, c: "üçî HAMB√öRGUER" },
            { n: "X-Tudo", p: 39.90, c: "üçî HAMB√öRGUER" },
            { n: "KM-Burger Simples", p: 29.90, c: "üî• ARTESANAL" },
            { n: "KM-Burger Salada", p: 33.90, c: "üî• ARTESANAL" },
            { n: "KM-Burger Bacon", p: 37.90, c: "üî• ARTESANAL" },
            { n: "KM-Burger Calabresa", p: 35.90, c: "üî• ARTESANAL" },
            { n: "KM-Burger MAX", p: 49.90, c: "üî• ARTESANAL" },
            { n: "KM-Chicken", p: 29.90, c: "üî• ARTESANAL" },
            { n: "Batata P", p: 16.90, c: "üçü POR√á√ïES" },
            { n: "Batata G", p: 26.90, c: "üçü POR√á√ïES" },
            { n: "Batata Queijo/Bacon G", p: 43.90, c: "üçü POR√á√ïES" },
            { n: "Calabresa c/ Fritas", p: 39.90, c: "üçü POR√á√ïES" },
            { n: "Contra file grelhado", p: 59.90, c: "üçü POR√á√ïES" },
            { n: "Chapa Mix", p: 159.90, c: "üçü POR√á√ïES" },
            { n: "Pastel Carne", p: 12.90, c: "ü•ü PAST√âIS" },
            { n: "Pastel Queijo", p: 12.90, c: "ü•ü PAST√âIS" },
            { n: "Refri Lata", p: 7.90, c: "ü•§ BEBIDAS" },
            { n: "Suco Lata", p: 7.90, c: "ü•§ BEBIDAS" }
        ];

        const acaiSizes = [{ n: "Copo 300ml", p: 10.90 }, { n: "Copo 400ml", p: 13.90 }, { n: "Copo 500ml", p: 20.90 }, { n: "Tigela 500ml", p: 28.90 }];
        const acaiExtras = [{ n: "Banana", p: 1.00 }, { n: "Morango", p: 3.00 }, { n: "Nutella", p: 6.00 }, { n: "Leite em p√≥", p: 1.00 }, { n: "Leite condensado", p: 1.00 }];

        let carrinho = [];
        let totalGeral = 0;
        let acaiAtual = null;

        function renderMenu() {
            const container = document.getElementById('categorias-container');
            const cats = [...new Set(cardapio.map(i => i.c))];
            container.innerHTML = cats.map(cat => `
                <section>
                    <h2 class="font-black text-lg text-km-vinho mb-3 border-l-4 border-km-vinho pl-2">${cat}</h2>
                    <div class="grid gap-3">
                        ${cardapio.filter(i => i.c === cat).map(item => `
                            <div class="bg-white p-4 rounded-2xl shadow-sm border flex justify-between items-center text-gray-800">
                                <div><p class="font-bold">${item.n}</p><p class="text-green-600 font-black">R$ ${item.p.toFixed(2)}</p></div>
                                <button onclick="addCarrinho('${item.n}', ${item.p})" class="bg-km-vinho text-white w-10 h-10 rounded-full font-bold shadow-lg">+</button>
                            </div>`).join('')}
                    </div>
                </section>`).join('');

            document.getElementById('acai-sizes').innerHTML = acaiSizes.map(s => `
                <button onclick="abrirModalAcai('${s.n}', ${s.p})" class="p-4 bg-white/10 border border-white/20 rounded-2xl text-center active:scale-95 transition">
                    <p class="text-sm font-bold text-white">${s.n}</p><p class="text-km-amarelo font-black">R$ ${s.p.toFixed(2)}</p>
                </button>`).join('');
        }

        function addCarrinho(n, p) {
            carrinho.push({n, p});
            totalGeral += p;
            document.getElementById('carrinho-total').innerText = `R$ ${totalGeral.toFixed(2)}`;
        }

        function abrirModalAcai(nome, preco) {
            acaiAtual = { nomeBase: nome, precoBase: preco, adicionais: [], total: preco };
            document.getElementById('acai-titulo').innerText = nome;
            renderAdicionaisAcai();
            atualizarSubtotalAcai();
            document.getElementById('modal-acai').classList.remove('hidden');
        }

        function renderAdicionaisAcai() {
            document.getElementById('lista-adicionais').innerHTML = acaiExtras.map(ex => `
                <label class="flex justify-between items-center bg-gray-50 p-4 rounded-xl border border-gray-100 mb-2">
                    <div class="flex items-center gap-2 text-gray-800"><input type="checkbox" onchange="toggleExtraAcai('${ex.n}', ${ex.p})" class="w-5 h-5 accent-purple-600"><span>${ex.n}</span></div>
                    <span class="text-purple-600 font-bold">+ R$ ${ex.p.toFixed(2)}</span>
                </label>`).join('');
        }

        function toggleExtraAcai(nome, preco) {
            const idx = acaiAtual.adicionais.indexOf(nome);
            if(idx > -1) { acaiAtual.adicionais.splice(idx, 1); acaiAtual.total -= preco; }
            else { acaiAtual.adicionais.push(nome); acaiAtual.total += preco; }
            atualizarSubtotalAcai();
        }

        function atualizarSubtotalAcai() { document.getElementById('acai-subtotal').innerText = `R$ ${acaiAtual.total.toFixed(2)}`; }

        function confirmarAcai() {
            const nomeFinal = acaiAtual.nomeBase + (acaiAtual.adicionais.length > 0 ? " (" + acaiAtual.adicionais.join(", ") + ")" : "");
            addCarrinho(nomeFinal, acaiAtual.total);
            document.getElementById('modal-acai').classList.add('hidden');
        }

        function toggleEndereco() { document.getElementById('endereco').classList.toggle('hidden', document.getElementById('tipo-entrega').value === 'retirada'); }
        
        function abrirCheckout() {
            if(carrinho.length === 0) return alert("Adicione itens no carrinho!");
            document.getElementById('modal-checkout').classList.remove('hidden');
        }

        function enviarPedidoFirebase() {
            const nome = document.getElementById('nome').value;
            const end = document.getElementById('endereco').value;
            const pag = document.getElementById('pagamento').value;
            const tipo = document.getElementById('tipo-entrega').value;
            if(!nome || !pag) return alert("Preencha nome e pagamento!");

            db.ref('pedidos').push().set({
                cliente: nome,
                endereco: tipo === 'entrega' ? end : 'RETIRADA NA LOJA',
                itens: carrinho.map(i => i.n).join(', '),
                total: totalGeral,
                pagamento: pag,
                status: 'novos',
                hora: new Date().toLocaleTimeString('pt-BR')
            }).then(() => {
                alert("PEDIDO RECEBIDO!");
                window.location.reload();
            });
        }

        window.onload = renderMenu;
    </script>
</body>
</html>
