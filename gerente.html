<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>CENTRAL KM BURGER - Gest√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        /* VISUAL APP PROFISSIONAL */
        body { background-color: #0c0c0e; color: #e4e4e7; font-family: 'Inter', sans-serif; }
        .column-bg { background-color: #18181b; border: 1px solid #27272a; min-height: 80vh; border-radius: 24px; padding: 16px; }
        
        /* AJUSTE PARA IMPRESSORA T√âRMICA 80mm */
        @media print {
            @page { margin: 0; size: auto; }
            body { background: white !important; color: black !important; margin: 0; padding: 0; }
            header, nav, button, .no-print { display: none !important; }
            
            #comanda-print {
                display: block !important;
                visibility: visible !important;
                width: 72mm;
                font-family: 'Courier New', Courier, monospace;
                font-size: 13px;
                color: black !important;
                background: white !important;
                white-space: pre-wrap;
                word-wrap: break-word;
                position: absolute;
                left: 0;
                top: 0;
                padding: 10px;
                line-height: 1.2;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="flex flex-col md:flex-row justify-between items-center mb-10 bg-zinc-900/50 p-6 rounded-3xl border border-zinc-800 shadow-2xl backdrop-blur-md">
        <div>
            <h1 class="text-3xl font-black italic text-red-600 tracking-tighter">KM BURGER CENTRAL</h1>
            <p class="text-zinc-500 font-mono text-[10px] uppercase tracking-[0.2em] mt-1">Gest√£o de Pedidos em Tempo Real</p>
        </div>
        <div class="mt-6 md:mt-0 bg-zinc-800/80 p-5 rounded-2xl border border-zinc-700 text-center min-w-[240px]">
            <span class="text-[10px] text-zinc-400 uppercase font-black tracking-widest">Faturamento de Hoje</span>
            <div id="faturamento" class="text-3xl font-black text-green-500 italic mt-1">R$ 0,00</div>
        </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
            <h2 class="text-center font-black text-orange-500 mb-5 flex items-center justify-center gap-2 text-sm tracking-widest uppercase">
                <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-orange-500"></span></span>
                Novos Pedidos
            </h2>
            <div id="coluna-novos" class="column-bg space-y-4"></div>
        </div>

        <div>
            <h2 class="text-center font-black text-blue-500 mb-5 text-sm tracking-widest uppercase">üî• Na Cozinha</h2>
            <div id="coluna-preparando" class="column-bg space-y-4"></div>
        </div>

        <div>
            <h2 class="text-center font-black text-green-500 mb-5 text-sm tracking-widest uppercase">‚úÖ Finalizados</h2>
            <div id="coluna-finalizados" class="column-bg space-y-4 opacity-50"></div>
        </div>
    </div>

    <pre id="comanda-print" class="hidden"></pre>

    <script>
        // Senha de Acesso
        const psw = prompt("KM BURGER - Senha de Gerente:");
        if(psw !== "km123") {
            document.body.innerHTML = "<div class='h-screen flex items-center justify-center text-red-600 font-black'>ACESSO NEGADO</div>";
        }

        // Configura√ß√£o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCXNjKn-uP2dpf_OG_pzUkqa-RnS-3V1L4",
            authDomain: "km-burguer.firebaseapp.com",
            projectId: "km-burguer",
            databaseURL: "https://km-burguer-default-rtdb.firebaseio.com",
            storageBucket: "km-burguer.firebasestorage.app",
            messagingSenderId: "426968901226",
            appId: "1:426968901226:web:e05f587e2c36acaa714c13"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Alerta Sonoro Profissional
        const somNovoPedido = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');

        // Escutar Banco de Dados
        db.ref('pedidos').on('value', (snap) => {
            const data = snap.val();
            render(data);
        });

        // Som de Alerta para novos pedidos
        db.ref('pedidos').on('child_added', (snap) => {
            if(snap.val().status === 'novos') {
                somNovoPedido.play().catch(() => console.log("Interaja com a p√°gina para ativar o som."));
            }
        });

        function render(pedidos) {
            const divs = { novos: '', preparando: '', finalizados: '' };
            let totalDia = 0;

            for (let id in pedidos) {
                const p = pedidos[id];
                const card = `
                    <div class="bg-zinc-900 p-5 rounded-3xl border-l-[6px] ${p.status === 'novos' ? 'border-orange-500 shadow-orange-900/10' : p.status === 'preparando' ? 'border-blue-500' : 'border-green-500'} shadow-xl">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="font-black text-white italic text-lg uppercase">${p.cliente.split(' ')[0]}</h3>
                            <span class="text-[10px] bg-zinc-800 px-2 py-1 rounded-lg text-zinc-500 font-mono tracking-tighter">${p.hora}</span>
                        </div>
                        <p class="text-sm text-zinc-300 font-medium mb-4">${p.itens}</p>
                        <div class="bg-zinc-800/50 p-3 rounded-xl text-[10px] text-zinc-500 mb-5 leading-relaxed">
                            <p>üìç ${p.endereco}</p>
                            <p class="mt-1 font-bold">üí≥ ${p.pagamento.toUpperCase()}</p>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-black text-green-500">R$ ${p.total.toFixed(2)}</span>
                            <div class="flex gap-2">
                                <button onclick="imprimirPedido('${id}')" class="bg-zinc-800 p-3 rounded-2xl hover:bg-zinc-700 transition">üñ®Ô∏è</button>
                                ${p.status === 'novos' ? `<button onclick="update('${id}', 'preparando')" class="bg-blue-600 px-4 py-2 rounded-2xl text-xs font-black uppercase tracking-wider">Preparar</button>` : ''}
                                ${p.status === 'preparando' ? `<button onclick="update('${id}', 'finalizados')" class="bg-green-600 px-4 py-2 rounded-2xl text-xs font-black uppercase tracking-wider">Finalizar</button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
                divs[p.status] += card;
                if(p.status === 'finalizados') totalDia += p.total;
            }

            document.getElementById('coluna-novos').innerHTML = divs.novos || '<p class="text-center text-zinc-700 text-[10px] mt-20 font-bold uppercase tracking-widest">Sil√™ncio na Cozinha...</p>';
            document.getElementById('coluna-preparando').innerHTML = divs.preparando;
            document.getElementById('coluna-finalizados').innerHTML = divs.finalizados;
            document.getElementById('faturamento').innerText = `R$ ${totalDia.toFixed(2)}`;
        }

        function update(id, st) { db.ref('pedidos/'+id).update({status: st}); }

        function imprimirPedido(id) {
            db.ref('pedidos/'+id).once('value', (s) => {
                const p = s.val();
                const comanda = `
      KM BURGER üçî
----------------------------
ID: #${id.slice(-4)}
HORA: ${p.hora}
CLIENTE: ${p.cliente.toUpperCase()}
----------------------------
ITENS:
${p.itens.split(', ').join('\n')}

----------------------------
TOTAL: R$ ${p.total.toFixed(2)}
PAGTO: ${p.pagamento.toUpperCase()}
END: ${p.endereco.toUpperCase()}
----------------------------
\n\n\n.`;
                document.getElementById('comanda-print').innerText = comanda;
                setTimeout(() => window.print(), 200);
            });
        }
    </script>
</body>
</html>
