<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KM BURGER - Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        /* AS CORES CL√ÅSSICAS */
        .bg-km-vinho { background-color: #4a0404; }
        .text-km-amarelo { color: #f59e0b; }
        .border-km-vinho { border-color: #4a0404; }
        
        /* Lista de sugest√£o de bairros */
        #sugestoes-bairro { max-height: 150px; overflow-y: auto; background: white; border: 1px solid #ddd; position: absolute; width: 100%; z-index: 50; }
        .bairro-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .bairro-item:hover { background-color: #f3f4f6; }
        
        /* Ocultar barra de rolagem */
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-100 font-sans pb-32">

    <div id="aviso-fechado" class="hidden fixed inset-0 z-[60] bg-black/90 flex flex-col items-center justify-center text-center p-6 backdrop-blur-sm">
        <div class="bg-red-600 p-6 rounded-full mb-4 text-white text-4xl shadow-lg border-4 border-white">üîí</div>
        <h2 class="text-3xl font-black text-white mb-2 uppercase">Loja Fechada</h2>
        <p class="text-gray-300 font-bold">Nosso delivery abre em breve!</p>
    </div>

    <header class="bg-km-vinho p-4 text-center text-white shadow-xl sticky top-0 z-50">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-3xl font-black italic text-km-amarelo tracking-tighter">KM BURGER üçî</h1>
                <div id="badge-status" class="flex items-center gap-1 mt-1 justify-start">
                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                    <p class="text-[10px] font-bold text-green-400 font-mono uppercase">Aberto Agora</p>
                </div>
            </div>
        </div>
        
        <nav class="flex gap-4 overflow-x-auto no-scrollbar pb-2">
            <a href="#tradicional" class="bg-black/20 px-4 py-2 rounded-full text-xs font-bold text-km-amarelo border border-km-amarelo/30 whitespace-nowrap">Tradicionais</a>
            <a href="#artesanal" class="bg-black/20 px-4 py-2 rounded-full text-xs font-bold text-km-amarelo border border-km-amarelo/30 whitespace-nowrap">Artesanais</a>
            <a href="#porcoes" class="bg-black/20 px-4 py-2 rounded-full text-xs font-bold text-km-amarelo border border-km-amarelo/30 whitespace-nowrap">Por√ß√µes</a>
            <a href="#pasteis" class="bg-black/20 px-4 py-2 rounded-full text-xs font-bold text-km-amarelo border border-km-amarelo/30 whitespace-nowrap">Past√©is</a>
            <a href="#acai" class="bg-black/20 px-4 py-2 rounded-full text-xs font-bold text-km-amarelo border border-km-amarelo/30 whitespace-nowrap">A√ßa√≠</a>
            <a href="#bebidas" class="bg-black/20 px-4 py-2 rounded-full text-xs font-bold text-km-amarelo border border-km-amarelo/30 whitespace-nowrap">Bebidas</a>
        </nav>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-8" id="menu-container"></main>

    <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 shadow-2xl max-w-md mx-auto z-40">
        <div class="flex justify-between items-center mb-2 px-2 font-bold text-gray-700">
            <span>Total:</span>
            <span id="cart-total" class="text-2xl text-green-600">R$ 0,00</span>
        </div>
        <button onclick="abrirCheckout()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold shadow-lg text-lg active:scale-95 transition uppercase">Finalizar Pedido</button>
    </div>

    <div id="modal-checkout" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl overflow-y-auto max-h-[90vh]">
            <h2 class="text-xl font-black mb-4 text-km-vinho text-center uppercase border-b pb-2">Seus Dados</h2>
            
            <div class="space-y-3">
                <input type="text" id="nome" placeholder="Seu Nome Completo" class="w-full p-4 border rounded-xl outline-none focus:border-km-vinho bg-gray-50">
                
                <select id="tipo-entrega" onchange="toggleEndereco()" class="w-full p-4 border rounded-xl outline-none bg-white font-bold text-gray-700">
                    <option value="entrega">üõµ Entrega (Delivery)</option>
                    <option value="retirada">üè™ Retirada na Loja</option>
                </select>

                <div id="area-delivery" class="space-y-3">
                    <div class="relative">
                        <input type="text" id="busca-bairro" onkeyup="filtrarBairros()" onclick="filtrarBairros()" placeholder="Digite seu Bairro..." class="w-full p-4 border rounded-xl outline-none focus:border-km-vinho bg-gray-50" autocomplete="off">
                        <div id="sugestoes-bairro" class="hidden rounded-xl shadow-xl"></div>
                    </div>
                    <input type="text" id="rua-numero" placeholder="Rua e N√∫mero" class="w-full p-4 border rounded-xl outline-none focus:border-km-vinho bg-gray-50">
                </div>

                <select id="pagamento" class="w-full p-4 border rounded-xl outline-none bg-white">
                    <option value="Pix">Pagamento via PIX</option>
                    <option value="Cart√£o">Cart√£o de Cr√©dito/D√©bito</option>
                    <option value="Dinheiro">Dinheiro (Precisa de troco?)</option>
                </select>

                <div class="bg-gray-100 p-4 rounded-xl text-sm space-y-1 text-gray-600">
                    <div class="flex justify-between"><span>Subtotal:</span><span id="resumo-sub">R$ 0,00</span></div>
                    <div class="flex justify-between" id="linha-taxa"><span>Taxa Entrega:</span><span id="resumo-taxa">R$ 0,00</span></div>
                    <div class="flex justify-between font-black text-lg text-km-vinho pt-2 border-t border-gray-300"><span>TOTAL:</span><span id="resumo-total">R$ 0,00</span></div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-2 mt-6">
                <button onclick="document.getElementById('modal-checkout').classList.add('hidden')" class="py-4 text-gray-500 font-bold uppercase text-xs">Voltar</button>
                <button onclick="enviarPedido()" class="bg-green-600 text-white py-4 rounded-xl font-bold shadow-lg uppercase text-sm">Enviar Pedido</button>
            </div>
        </div>
    </div>

    <div id="modal-acai" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6">
            <h2 id="acai-titulo" class="text-xl font-bold text-purple-900 mb-4">Monte seu A√ßa√≠</h2>
            <div id="lista-adicionais" class="space-y-2 max-h-60 overflow-y-auto pr-2"></div>
            <div class="border-t pt-4 mt-4 font-bold flex flex-col gap-3">
                <div class="flex justify-between text-lg"><span>Total:</span><span id="acai-total-modal" class="text-green-600">R$ 0,00</span></div>
                <button onclick="confirmarAcai()" class="w-full bg-purple-600 text-white py-3 rounded-xl">ADICIONAR</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyCXNjKn-uP2dpf_OG_pzUkqa-RnS-3V1L4", databaseURL: "https://km-burguer-default-rtdb.firebaseio.com", projectId: "km-burguer" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- LISTA DE BAIRROS (EDITE AQUI) ---
        const listaBairros = [
            { nome: "Centro", taxa: 0.00 }, { nome: "Vila Nova", taxa: 5.00 }, { nome: "Jardim das Flores", taxa: 7.00 },
            { nome: "Parque Industrial", taxa: 10.00 }, { nome: "Zona Rural", taxa: 15.00 }
        ];

        const cardapio = [
            { n: "X-Burguer", p: 19.90, c: "Tradicional" }, { n: "X-Salada", p: 22.90, c: "Tradicional" },
            { n: "X-Bacon", p: 27.90, c: "Tradicional" }, { n: "X-Calabresa", p: 24.90, c: "Tradicional" },
            { n: "X-Egg", p: 24.90, c: "Tradicional" }, { n: "X-Frango", p: 24.90, c: "Tradicional" },
            { n: "X-Tudo", p: 39.90, c: "Tradicional" },
            { n: "KM-Simples", p: 29.90, c: "Artesanal" }, { n: "KM-Salada", p: 33.90, c: "Artesanal" },
            { n: "KM-Bacon", p: 37.90, c: "Artesanal" }, { n: "KM-MAX", p: 49.90, c: "Artesanal" },
            { n: "Batata P", p: 16.90, c: "Por√ß√µes" }, { n: "Batata G", p: 26.90, c: "Por√ß√µes" },
            { n: "Chapa Mix", p: 159.90, c: "Por√ß√µes" }, { n: "Frango Empanado", p: 49.90, c: "Por√ß√µes" },
            { n: "Pastel Carne", p: 12.90, c: "Past√©is" }, { n: "Pastel Queijo", p: 12.90, c: "Past√©is" },
            { n: "Pastel Nutella", p: 15.90, c: "Past√©is" },
            { n: "A√ßa√≠ 300ml", p: 10.90, c: "A√ßa√≠", isAcai: true }, { n: "A√ßa√≠ 500ml", p: 20.90, c: "A√ßa√≠", isAcai: true },
            { n: "Refri Lata", p: 7.90, c: "Bebidas" }, { n: "√Ågua", p: 3.90, c: "Bebidas" }
        ];
        const acaiExtras = [{ n: "Banana", p: 1.00 }, { n: "Morango", p: 3.00 }, { n: "Leite em p√≥", p: 1.00 }, { n: "Leite Cond.", p: 1.00 }, { n: "Pa√ßoca", p: 2.00 }];
        let carrinho = []; let total = 0; let taxaEntrega = 0; let acaiAtual = null;

        // Monitorar Loja Aberta/Fechada
        db.ref('config/loja_aberta').on('value', snap => {
            const status = snap.val();
            const aviso = document.getElementById('aviso-fechado');
            const badge = document.getElementById('badge-status');
            if(status === false) { aviso.classList.remove('hidden'); badge.innerHTML = '<span class="text-xs font-bold text-red-400">FECHADO</span>'; } 
            else { aviso.classList.add('hidden'); badge.innerHTML = '<div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div><p class="text-[10px] font-bold text-green-400 uppercase">Aberto Agora</p>'; }
        });

        function renderMenu() {
            const container = document.getElementById('menu-container');
            const cats = [...new Set(cardapio.map(i => i.c))];
            container.innerHTML = cats.map(cat => `
                <section id="${cat.toLowerCase()}"><h2 class="font-black text-lg text-km-vinho mb-3 border-l-4 border-km-vinho pl-2 uppercase">${cat}</h2>
                <div class="grid gap-3">${cardapio.filter(i => i.c === cat).map(i => `
                    <div class="bg-white p-4 rounded-2xl shadow-sm border flex justify-between items-center">
                        <div><p class="font-bold text-gray-800 uppercase text-sm">${i.n}</p><p class="text-green-600 font-black">R$ ${i.p.toFixed(2)}</p></div>
                        <button onclick="${i.isAcai ? `abrirAcai('${i.n}',${i.p})` : `add('${i.n}',${i.p})`}" class="bg-km-vinho text-white w-10 h-10 rounded-full font-bold shadow-lg active:scale-95">+</button>
                    </div>`).join('')}</div></section>`).join('');
        }

        // BUSCA BAIRROS INTELIGENTE
        function filtrarBairros() {
            const termo = document.getElementById('busca-bairro').value.toLowerCase();
            const lista = document.getElementById('sugestoes-bairro');
            lista.innerHTML = '';
            
            if(termo.length < 1) { lista.classList.add('hidden'); return; }
            
            const matches = listaBairros.filter(b => b.nome.toLowerCase().includes(termo));
            if(matches.length > 0) {
                matches.forEach(b => {
                    const div = document.createElement('div');
                    div.className = "bairro-item text-sm flex justify-between";
                    div.innerHTML = `<span>${b.nome}</span><span class="font-bold text-green-600">+ R$ ${b.taxa.toFixed(2)}</span>`;
                    div.onclick = () => {
                        document.getElementById('busca-bairro').value = b.nome;
                        taxaEntrega = b.taxa;
                        lista.classList.add('hidden');
                        calcTotal();
                    };
                    lista.appendChild(div);
                });
                lista.classList.remove('hidden');
            } else { lista.classList.add('hidden'); }
        }

        function add(n,p){ carrinho.push({n,p}); atualizarTotal(); }
        function atualizarTotal() { total = carrinho.reduce((s,i)=>s+i.p,0); document.getElementById('cart-total').innerText = `R$ ${total.toFixed(2)}`; }
        
        function abrirCheckout() { 
            if(carrinho.length===0) return alert("Carrinho vazio!"); 
            calcTotal();
            document.getElementById('modal-checkout').classList.remove('hidden'); 
        }

        function toggleEndereco() {
            const tipo = document.getElementById('tipo-entrega').value;
            const area = document.getElementById('area-delivery');
            area.style.display = tipo === 'retirada' ? 'none' : 'block';
            taxaEntrega = tipo === 'retirada' ? 0 : taxaEntrega;
            // Se mudou para entrega e est√° vazio, reseta taxa
            if(tipo === 'entrega' && document.getElementById('busca-bairro').value === '') taxaEntrega = 0;
            document.getElementById('linha-taxa').style.display = tipo === 'retirada' ? 'none' : 'flex';
            calcTotal();
        }

        function calcTotal() {
            document.getElementById('resumo-sub').innerText = `R$ ${total.toFixed(2)}`;
            document.getElementById('resumo-taxa').innerText = `R$ ${taxaEntrega.toFixed(2)}`;
            document.getElementById('resumo-total').innerText = `R$ ${(total + taxaEntrega).toFixed(2)}`;
        }

        function enviarPedido() {
            const n = document.getElementById('nome').value;
            const tipo = document.getElementById('tipo-entrega').value;
            let end = "RETIRADA";
            if(tipo === 'entrega') {
                const b = document.getElementById('busca-bairro').value;
                const r = document.getElementById('rua-numero').value;
                if(!b || !r) return alert("Endere√ßo incompleto!");
                end = `${b}, ${r}`;
            }
            if(!n) return alert("Nome obrigat√≥rio!");

            db.ref('pedidos').push().set({
                cliente: n, itens: carrinho.map(i=>i.n).join(', '),
                total: total + taxaEntrega, taxa: taxaEntrega,
                pagamento: document.getElementById('pagamento').value,
                endereco: end, status: 'novos',
                hora: new Date().toLocaleTimeString('pt-BR').slice(0,5),
                data: new Date().toISOString().split('T')[0]
            }).then(() => { alert("Enviado!"); window.location.reload(); });
        }

        function abrirAcai(n,p){ acaiAtual={n,p,ad:[],t:p}; document.getElementById('acai-titulo').innerText=n; document.getElementById('lista-adicionais').innerHTML=acaiExtras.map(e=>`<label class="flex justify-between p-2 border rounded mb-2"><div class="flex gap-2"><input type="checkbox" onchange="toggleAd('${e.n}',${e.p})"><span>${e.n}</span></div><span>+R$${e.p}</span></label>`).join(''); document.getElementById('acai-total-modal').innerText=`R$ ${p.toFixed(2)}`; document.getElementById('modal-acai').classList.remove('hidden'); }
        function toggleAd(n,p){ const i=acaiAtual.ad.indexOf(n); if(i>-1){acaiAtual.ad.splice(i,1);acaiAtual.t-=p}else{acaiAtual.ad.push(n);acaiAtual.t+=p} document.getElementById('acai-total-modal').innerText=`R$ ${acaiAtual.t.toFixed(2)}`; }
        function confirmarAcai(){ add(acaiAtual.n + (acaiAtual.ad.length ? ` (+ ${acaiAtual.ad.join(',')})` : ''), acaiAtual.t); document.getElementById('modal-acai').classList.add('hidden'); }

        // Fechar lista se clicar fora
        document.addEventListener('click', e => { if(e.target.id !== 'busca-bairro') document.getElementById('sugestoes-bairro').classList.add('hidden'); });

        renderMenu();
    </script>
</body>
</html>
